// Handling form submission
document.getElementById('location-form').addEventListener('submit', function(e) {
    e.preventDefault(); 

    var location = document.getElementById('location-input').value; // Get location input

    // Fetching geolocation data from Google Maps API
    fetch('https://maps.googleapis.com/maps/api/geocode/json?address=' + location + '&key=AIzaSyBp8mCZ8DuGAHg3Ixre2aLjDt6K6m5hoB8')
    .then(response => response.json())
    .then(data => {
        var lat = data.results[0].geometry.location.lat;
        var lng = data.results[0].geometry.location.lng;

        if (marker) {
            marker.setMap(null);
        }

        marker = new google.maps.Marker({
            position: new google.maps.LatLng(lat, lng),
            map: map
        });

        var latLng = new google.maps.LatLng(lat, lng);
        map.panTo(latLng);  // Smooth transition to new location
        smoothZoom(map, 18, map.getZoom());  // Smooth zooming to new location

        // Fetching segments from Strava API
        fetch(`https://www.strava.com/api/v3/segments/explore?bounds=${lat-0.1},${lng-0.1},${lat+0.1},${lng+0.1}&activity_type=cycling&access_token=a0253216a79d18e574d730373cbfce49e70a4f15`)
        .then(response => response.json())
        .then(data => {
            // Add segments as markers on the map
            data.segments.forEach(segment => {
                var segmentMarker = new google.maps.Marker({
                    position: new google.maps.LatLng(segment.start_latlng[0], segment.start_latlng[1]),
                    map: map,
                    title: segment.name
                });
            });
        });
    })
    .catch(error => console.error(error));
});
